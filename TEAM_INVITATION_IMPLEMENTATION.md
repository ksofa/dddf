# Реализация функциональности приглашений в команду для PM

## Обзор изменений

Была реализована функциональность, позволяющая Project Manager (PM) отправлять приглашения в свои команды вместо прямого добавления участников.

## Изменения в Frontend

### 1. Модификация AddMemberModal.tsx
- **Изменен заголовок**: "Добавить в команду" → "Пригласить в команду"
- **Изменена функциональность**: `handleAddMembers` → `handleSendInvitations`
- **Изменен API вызов**: Теперь отправляет приглашения через `/teams/:teamId/invite`
- **Изменена иконка**: Заменена на иконку отправки письма
- **Изменен текст кнопки**: "Добавить участников" → "Отправить приглашения"

### 2. Модификация TeamsView/index.tsx
- **Изменен текст кнопки**: "Добавить в команду" → "Пригласить в команду"
- **Изменена иконка кнопки**: Заменена на иконку отправки письма

## Изменения в Backend

### 1. Очистка routes/teams.js
- **Удален старый endpoint**: `POST /:id/invite` с проверкой роли 'executor'
- **Оставлен новый endpoint**: `POST /:teamId/invite` без ограничений по ролям

### 2. Улучшения в endpoint приглашений
- **Добавлена проверка существования получателя**: Проверяется, что пользователь существует
- **Улучшена обработка ошибок**: Более детальные сообщения об ошибках
- **Добавлены значения по умолчанию**: Для полей coverLetter, rate и других

## Функциональность

### Что может PM:
✅ Просматривать список доступных пользователей для своих команд
✅ Отправлять приглашения пользователям в свои команды
✅ Видеть только свои команды (ранее реализованная функциональность)

### Что НЕ может PM:
❌ Отправлять приглашения от чужих команд
❌ Добавлять участников напрямую в команду
❌ Видеть команды других PM

## Безопасность

### Проверки доступа:
1. **Аутентификация**: Все endpoint защищены middleware аутентификации
2. **Авторизация**: PM может отправлять приглашения только от своих команд
3. **Валидация данных**: Проверяется существование команды и получателя
4. **Изоляция данных**: PM видит только свои команды и может работать только с ними

## Тестирование

### Созданы тесты:
- `scripts/test-team-invitations.js` - Комплексное тестирование функциональности

### Результаты тестирования:
✅ PM может отправлять приглашения от своих команд
✅ PM не может отправлять приглашения от чужих команд  
✅ Приглашения создаются в базе данных
✅ Все проверки безопасности работают корректно

## Структура данных приглашений

Приглашения сохраняются в коллекции `team_invitations` со следующей структурой:

```javascript
{
  teamId: string,           // ID команды
  senderId: string,         // ID отправителя (PM)
  receiverId: string,       // ID получателя
  projectType: string,      // Тип проекта
  rate: string,            // Ставка
  startDate: string,       // Дата начала
  estimatedDuration: number, // Длительность
  estimatedDurationUnit: string, // Единица измерения
  coverLetter: string,     // Сопроводительное письмо
  status: 'pending',       // Статус приглашения
  createdAt: timestamp,    // Дата создания
  updatedAt: timestamp     // Дата обновления
}
```

## Заключение

Реализация успешно завершена. PM теперь может отправлять приглашения в свои команды через удобный интерфейс, при этом соблюдаются все требования безопасности и изоляции данных. 