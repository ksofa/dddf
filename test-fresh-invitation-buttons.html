<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∫–Ω–æ–ø–æ–∫ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è - –ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .team-card {
            transition: all 0.3s ease;
        }
        .team-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .btn-invite {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }
        .btn-propose {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-success { background-color: #10b981; }
        .status-error { background-color: #ef4444; }
        .status-pending { background-color: #f59e0b; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">üß™ –¢–µ—Å—Ç –∫–Ω–æ–ø–æ–∫ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è</h1>
                <p class="text-gray-600">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π —Å –Ω–æ–≤–æ–π –∫–æ–º–∞–Ω–¥–æ–π</p>
            </div>

            <!-- –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4">üì° –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="text-center">
                        <div id="backend-status" class="status-indicator status-pending"></div>
                        <span>Backend API</span>
                        <div id="backend-url" class="text-sm text-gray-500">http://localhost:3000</div>
                    </div>
                    <div class="text-center">
                        <div id="frontend-status" class="status-indicator status-pending"></div>
                        <span>Frontend</span>
                        <div id="frontend-url" class="text-sm text-gray-500">http://localhost:5173</div>
                    </div>
                    <div class="text-center">
                        <div id="auth-status" class="status-indicator status-pending"></div>
                        <span>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è PM</span>
                        <div id="auth-info" class="text-sm text-gray-500">pm@test.test</div>
                    </div>
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4">üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h2>
                <div class="flex flex-wrap gap-3">
                    <button id="login-btn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors">
                        üîë –í–æ–π—Ç–∏ –∫–∞–∫ PM
                    </button>
                    <button id="load-teams-btn" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors">
                        üë• –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã
                    </button>
                    <button id="test-invite-btn" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 transition-colors">
                        üìß –¢–µ—Å—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
                    </button>
                    <button id="clear-log-btn" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 transition-colors">
                        üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥
                    </button>
                </div>
            </div>

            <!-- –ö–æ–º–∞–Ω–¥—ã -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-semibold mb-4">üë• –ö–æ–º–∞–Ω–¥—ã PM</h2>
                <div id="teams-container" class="space-y-4">
                    <div class="text-center text-gray-500 py-8">
                        –ù–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã" –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
                    </div>
                </div>
            </div>

            <!-- –õ–æ–≥ -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">üìã –õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π</h2>
                <div id="log-container" class="bg-gray-100 rounded p-4 h-64 overflow-y-auto font-mono text-sm">
                    <div class="text-gray-500">–õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api';
        let authToken = null;
        let currentTeams = [];

        // –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        function log(message, type = 'info') {
            const container = document.getElementById('log-container');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: 'text-blue-600',
                success: 'text-green-600',
                error: 'text-red-600',
                warning: 'text-yellow-600'
            };
            
            const logEntry = document.createElement('div');
            logEntry.className = `mb-1 ${colors[type] || colors.info}`;
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            
            container.appendChild(logEntry);
            container.scrollTop = container.scrollHeight;
        }

        function updateStatus(elementId, status) {
            const element = document.getElementById(elementId);
            element.className = `status-indicator status-${status}`;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
        async function checkConnections() {
            log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π...');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ backend
            try {
                const response = await fetch(`${API_BASE}/health`);
                if (response.ok) {
                    updateStatus('backend-status', 'success');
                    log('‚úÖ Backend API –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
                } else {
                    updateStatus('backend-status', 'error');
                    log('‚ùå Backend API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
                }
            } catch (error) {
                updateStatus('backend-status', 'error');
                log('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Backend API', 'error');
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ frontend
            try {
                const response = await fetch('http://localhost:5173/');
                if (response.ok) {
                    updateStatus('frontend-status', 'success');
                    log('‚úÖ Frontend –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
                } else {
                    updateStatus('frontend-status', 'error');
                    log('‚ùå Frontend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
                }
            } catch (error) {
                updateStatus('frontend-status', 'error');
                log('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Frontend', 'error');
            }
        }

        // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
        async function login() {
            log('üîë –ü–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞ –∫–∞–∫ PM...');
            try {
                const response = await fetch(`${API_BASE}/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: 'pm@test.test',
                        password: 'password123'
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    authToken = data.token;
                    updateStatus('auth-status', 'success');
                    log('‚úÖ –£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è PM', 'success');
                    return true;
                } else {
                    const error = await response.text();
                    updateStatus('auth-status', 'error');
                    log(`‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${error}`, 'error');
                    return false;
                }
            } catch (error) {
                updateStatus('auth-status', 'error');
                log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${error.message}`, 'error');
                return false;
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–∞–Ω–¥
        async function loadTeams() {
            if (!authToken) {
                log('‚ùå –ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è', 'error');
                return;
            }

            log('üë• –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–∞–Ω–¥ PM...');
            try {
                const response = await fetch(`${API_BASE}/teams`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const teams = await response.json();
                    currentTeams = teams;
                    log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∫–æ–º–∞–Ω–¥: ${teams.length}`, 'success');
                    renderTeams(teams);
                } else {
                    const error = await response.text();
                    log(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–º–∞–Ω–¥: ${error}`, 'error');
                }
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–æ–º–∞–Ω–¥: ${error.message}`, 'error');
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥
        function renderTeams(teams) {
            const container = document.getElementById('teams-container');
            
            if (teams.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        –ö–æ–º–∞–Ω–¥—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
                    </div>
                `;
                return;
            }

            container.innerHTML = teams.map(team => `
                <div class="team-card bg-gray-50 rounded-lg p-6 border border-gray-200">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">${team.name}</h3>
                            <p class="text-gray-600 mb-3">${team.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}</p>
                            <div class="text-sm text-gray-500">
                                <div>üë§ PM: ${team.pm?.displayName || team.pm?.email || '–ù–µ —É–∫–∞–∑–∞–Ω'}</div>
                                <div>üë• –£—á–∞—Å—Ç–Ω–∏–∫–æ–≤: ${team.members?.length || 0}</div>
                                <div>üÜî ID: ${team.id}</div>
                            </div>
                        </div>
                        <div class="flex flex-col gap-2 ml-4">
                            <button 
                                onclick="testInvitation('${team.id}')" 
                                class="btn-invite text-white px-4 py-2 rounded text-sm hover:opacity-90 transition-opacity"
                            >
                                ‚ûï –ü–†–ò–ì–õ–ê–°–ò–¢–¨
                            </button>
                            <button 
                                onclick="testProposal('${team.id}')" 
                                class="btn-propose text-white px-4 py-2 rounded text-sm hover:opacity-90 transition-opacity"
                            >
                                üìß –ü–†–ï–î–õ–û–ñ–ò–¢–¨
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // –¢–µ—Å—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
        async function testInvitation(teamId) {
            if (!authToken) {
                log('‚ùå –ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è', 'error');
                return;
            }

            log(`üìß –¢–µ—Å—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –¥–ª—è –∫–æ–º–∞–Ω–¥—ã ${teamId}...`);
            
            try {
                // –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                const usersResponse = await fetch(`${API_BASE}/teams/${teamId}/available-users`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (!usersResponse.ok) {
                    const error = await usersResponse.text();
                    log(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${error}`, 'error');
                    return;
                }

                const users = await usersResponse.json();
                log(`‚úÖ –ù–∞–π–¥–µ–Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${users.length}`, 'success');

                if (users.length === 0) {
                    log('‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è', 'error');
                    return;
                }

                // –ü—Ä–∏–≥–ª–∞—à–∞–µ–º –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const userToInvite = users[0];
                log(`üë§ –ü—Ä–∏–≥–ª–∞—à–∞–µ–º: ${userToInvite.displayName || userToInvite.email}`);

                const inviteResponse = await fetch(`${API_BASE}/teams/${teamId}/invite`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        receiverId: userToInvite.id,
                        role: 'developer',
                        projectType: 'without_project',
                        coverLetter: '–¢–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å'
                    })
                });

                if (inviteResponse.ok) {
                    const result = await inviteResponse.json();
                    log(`‚úÖ –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! ID: ${result.invitationId}`, 'success');
                } else {
                    const error = await inviteResponse.text();
                    log(`‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è: ${error}`, 'error');
                }

            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è: ${error.message}`, 'error');
            }
        }

        // –¢–µ—Å—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
        async function testProposal(teamId) {
            log(`üìß –¢–µ—Å—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –∫–æ–º–∞–Ω–¥—ã ${teamId}...`, 'warning');
            log('‚ÑπÔ∏è –§—É–Ω–∫—Ü–∏—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'warning');
        }

        // –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–∞
        function clearLog() {
            document.getElementById('log-container').innerHTML = '<div class="text-gray-500">–õ–æ–≥ –æ—á–∏—â–µ–Ω...</div>';
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.getElementById('login-btn').addEventListener('click', login);
        document.getElementById('load-teams-btn').addEventListener('click', loadTeams);
        document.getElementById('test-invite-btn').addEventListener('click', () => {
            if (currentTeams.length > 0) {
                testInvitation(currentTeams[0].id);
            } else {
                log('‚ùå –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã', 'error');
            }
        });
        document.getElementById('clear-log-btn').addEventListener('click', clearLog);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.addEventListener('load', () => {
            log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...');
            checkConnections();
        });
    </script>
</body>
</html> 