<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç Invites –∏ Applications</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .success {
            color: green;
            background-color: #d4edda;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .error {
            color: red;
            background-color: #f8d7da;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .result {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            white-space: pre-wrap;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            background-color: #e9ecef;
            border: 1px solid #ddd;
            cursor: pointer;
            margin-right: 5px;
        }
        .tab.active {
            background-color: #007bff;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ –¢–µ—Å—Ç Invites –∏ Applications</h1>
        
        <div class="tabs">
            <div class="tab active" onclick="showTab('applications')">Applications (–ó–∞—è–≤–∫–∏)</div>
            <div class="tab" onclick="showTab('invites')">Invites (–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è)</div>
            <div class="tab" onclick="showTab('admin')">Admin Panel</div>
        </div>

        <!-- Applications Tab -->
        <div id="applications" class="tab-content active">
            <div class="section">
                <h2>üìù –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)</h2>
                <form id="applicationForm">
                    <div class="form-group">
                        <label>–§–ò–û *:</label>
                        <input type="text" name="fullName" value="–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤" required>
                    </div>
                    <div class="form-group">
                        <label>–¢–µ–ª–µ—Ñ–æ–Ω *:</label>
                        <input type="tel" name="phone" value="+7 999 123-45-67" required>
                    </div>
                    <div class="form-group">
                        <label>Email:</label>
                        <input type="email" name="email" value="ivan@test.com">
                    </div>
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ *:</label>
                        <input type="text" name="projectTitle" value="–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è" required>
                    </div>
                    <div class="form-group">
                        <label>–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ *:</label>
                        <textarea name="projectDescription" rows="3" required>–ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è iOS –∏ Android —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ —á–∞—Ç–∞ –∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏</textarea>
                    </div>
                    <div class="form-group">
                        <label>–°—Ç–∞–≤–∫–∞:</label>
                        <select name="rate">
                            <option value="–î–æ–≥–æ–≤–æ—Ä–Ω–∞—è">–î–æ–≥–æ–≤–æ—Ä–Ω–∞—è</option>
                            <option value="–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è">–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è</option>
                            <option value="–ü–æ—á–∞—Å–æ–≤–∞—è">–ü–æ—á–∞—Å–æ–≤–∞—è</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>–î–∞—Ç–∞ —Å—Ç–∞—Ä—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞:</label>
                        <input type="date" name="startDate" value="2025-02-17">
                    </div>
                    <div class="form-group">
                        <label>–û—Ü–µ–Ω–æ—á–Ω–æ–µ –≤—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:</label>
                        <input type="number" name="estimatedDuration" value="6" min="1">
                        <select name="estimatedDurationUnit">
                            <option value="days">–î–Ω–µ–π</option>
                            <option value="weeks">–ù–µ–¥–µ–ª—å</option>
                            <option value="months" selected>–ú–µ—Å—è—Ü–µ–≤</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ (—Ç–µ–∫—Å—Ç):</label>
                        <textarea name="techSpec" rows="3">React Native, Firebase, Google Maps API, Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</textarea>
                    </div>
                    <div class="form-group">
                        <label>–§–∞–π–ª –¢–ó:</label>
                        <input type="file" name="techSpecFile" accept=".pdf,.doc,.docx,.txt,.jpg,.png">
                    </div>
                    <div class="form-group">
                        <label>–°–æ–ø—Ä–æ–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∏—Å—å–º–æ:</label>
                        <textarea name="coverLetter" rows="3">–ü—Ä–æ–µ–∫—Ç –≤–∞–∂–µ–Ω –¥–ª—è –Ω–∞—à–µ–π –∫–æ–º–ø–∞–Ω–∏–∏. –ì–æ—Ç–æ–≤—ã –æ–±—Å—É–∂–¥–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –∏ –±—é–¥–∂–µ—Ç. –ó–æ–ª–æ—Ç—ã–µ –≥–æ—Ä—ã –æ–±–µ—â–∞—é-–æ–±–µ—â–∞—é, –∫—É–ø–∏—Ç—å—Å—è –Ω–∞ –Ω–∏—Ö –±—É–¥–µ—à—å.</textarea>
                    </div>
                    <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
                </form>
                <div id="applicationResult"></div>
            </div>
        </div>

        <!-- Invites Tab -->
        <div id="invites" class="tab-content">
            <div class="section">
                <h2>üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è PM</h2>
                <div class="form-group">
                    <label>Email PM:</label>
                    <input type="email" id="pmEmail" value="pm@mail.ru">
                </div>
                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="pmPassword" value="123456">
                </div>
                <button onclick="loginPM()">–í–æ–π—Ç–∏ –∫–∞–∫ PM</button>
                <div id="pmLoginResult"></div>
            </div>

            <div class="section">
                <h2>üì® –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ</h2>
                <form id="inviteForm">
                    <div class="form-group">
                        <label>ID –ø—Ä–æ–µ–∫—Ç–∞:</label>
                        <input type="text" name="projectId" placeholder="–í–≤–µ–¥–∏—Ç–µ ID –ø—Ä–æ–µ–∫—Ç–∞">
                    </div>
                    <div class="form-group">
                        <label>ID –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è:</label>
                        <input type="text" name="executorId" placeholder="–í–≤–µ–¥–∏—Ç–µ ID –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è">
                    </div>
                    <div class="form-group">
                        <label>–†–æ–ª—å:</label>
                        <input type="text" name="role" value="executor">
                    </div>
                    <div class="form-group">
                        <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                        <textarea name="description" rows="2">–ü—Ä–∏–≥–ª–∞—à–∞–µ–º –≤–∞—Å –ø—Ä–∏–Ω—è—Ç—å —É—á–∞—Å—Ç–∏–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ</textarea>
                    </div>
                    <div class="form-group">
                        <label>–°—Ç–∞–≤–∫–∞:</label>
                        <select name="rate">
                            <option value="–î–æ–≥–æ–≤–æ—Ä–Ω–∞—è">–î–æ–≥–æ–≤–æ—Ä–Ω–∞—è</option>
                            <option value="–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è">–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è</option>
                            <option value="–ü–æ—á–∞—Å–æ–≤–∞—è">–ü–æ—á–∞—Å–æ–≤–∞—è</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>–î–∞—Ç–∞ —Å—Ç–∞—Ä—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞:</label>
                        <input type="date" name="startDate" value="2025-02-17">
                    </div>
                    <div class="form-group">
                        <label>–û—Ü–µ–Ω–æ—á–Ω–æ–µ –≤—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:</label>
                        <input type="number" name="estimatedDuration" value="6" min="1">
                        <select name="estimatedDurationUnit">
                            <option value="days">–î–Ω–µ–π</option>
                            <option value="weeks">–ù–µ–¥–µ–ª—å</option>
                            <option value="months" selected>–ú–µ—Å—è—Ü–µ–≤</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>–§–∞–π–ª –¢–ó:</label>
                        <input type="file" name="techSpecFile" accept=".pdf,.doc,.docx,.txt,.jpg,.png">
                    </div>
                    <div class="form-group">
                        <label>–°–æ–ø—Ä–æ–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∏—Å—å–º–æ:</label>
                        <textarea name="coverLetter" rows="3">–ü—Ä–∏–≥–ª–∞—à–∞–µ–º –≤–∞—Å –≤ –Ω–∞—à –ø—Ä–æ–µ–∫—Ç. –£—Å–ª–æ–≤–∏—è —Ä–∞–±–æ—Ç—ã –æ–±—Å—É–∂–¥–∞—é—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ.</textarea>
                    </div>
                    <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ</button>
                </form>
                <div id="inviteResult"></div>
            </div>
        </div>

        <!-- Admin Tab -->
        <div id="admin" class="tab-content">
            <div class="section">
                <h2>üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω–∞</h2>
                <div class="form-group">
                    <label>Email –∞–¥–º–∏–Ω–∞:</label>
                    <input type="email" id="adminEmail" value="ad@mail.ru">
                </div>
                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="adminPassword" value="123456">
                </div>
                <button onclick="loginAdmin()">–í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω</button>
                <div id="adminLoginResult"></div>
            </div>

            <div class="section">
                <h2>üìã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∞–º–∏</h2>
                <button onclick="loadApplications()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞—è–≤–∫–∏</button>
                <button onclick="loadPMs()">–ó–∞–≥—Ä—É–∑–∏—Ç—å PM</button>
                <div id="applicationsListResult"></div>
                <div id="applicationsList"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api';
        let authToken = null;
        let projectManagers = [];

        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // Show result
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = message;
            element.className = `result ${type}`;
        }

        // ============ APPLICATIONS ============

        // Create application
        document.getElementById('applicationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            try {
                const formData = new FormData(e.target);
                
                const response = await fetch(`${API_BASE}/applications`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showResult('applicationResult', `‚úÖ –ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ!\nID: ${result.applicationId}`, 'success');
                } else {
                    throw new Error(result.message || '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏');
                }
            } catch (error) {
                showResult('applicationResult', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        });

        // ============ INVITES ============

        // Login PM
        async function loginPM() {
            try {
                const email = document.getElementById('pmEmail').value;
                const password = document.getElementById('pmPassword').value;
                
                const response = await fetch(`${API_BASE}/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    authToken = data.token;
                    showResult('pmLoginResult', '‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
                } else {
                    throw new Error(data.message || '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞');
                }
            } catch (error) {
                showResult('pmLoginResult', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        // Create invite
        document.getElementById('inviteForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!authToken) {
                showResult('inviteResult', '‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –∫–∞–∫ PM', 'error');
                return;
            }
            
            try {
                const formData = new FormData(e.target);
                const projectId = formData.get('projectId');
                
                const response = await fetch(`${API_BASE}/invites/projects/${projectId}/team/invite`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showResult('inviteResult', `‚úÖ –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!\nID: ${result.inviteId}`, 'success');
                } else {
                    throw new Error(result.message || '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è');
                }
            } catch (error) {
                showResult('inviteResult', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        });

        // ============ ADMIN ============

        // Login admin
        async function loginAdmin() {
            try {
                const email = document.getElementById('adminEmail').value;
                const password = document.getElementById('adminPassword').value;
                
                const response = await fetch(`${API_BASE}/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    authToken = data.token;
                    showResult('adminLoginResult', '‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
                } else {
                    throw new Error(data.message || '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞');
                }
            } catch (error) {
                showResult('adminLoginResult', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        // Load applications
        async function loadApplications() {
            if (!authToken) {
                showResult('applicationsListResult', '‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –∫–∞–∫ –∞–¥–º–∏–Ω', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/applications`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const applications = await response.json();
                
                if (response.ok) {
                    showResult('applicationsListResult', `‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${applications.length} –∑–∞—è–≤–æ–∫`, 'success');
                    displayApplications(applications);
                } else {
                    throw new Error(applications.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–æ–∫');
                }
            } catch (error) {
                showResult('applicationsListResult', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        // Load PMs
        async function loadPMs() {
            if (!authToken) {
                showResult('applicationsListResult', '‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –∫–∞–∫ –∞–¥–º–∏–Ω', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/users?role=pm`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const users = await response.json();
                
                if (response.ok) {
                    projectManagers = users.filter(user => user.roles && user.roles.includes('pm'));
                    showResult('applicationsListResult', `‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${projectManagers.length} –ø—Ä–æ–µ–∫—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤`, 'success');
                } else {
                    throw new Error(users.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ PM');
                }
            } catch (error) {
                showResult('applicationsListResult', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        // Display applications
        function displayApplications(applications) {
            const container = document.getElementById('applicationsList');
            
            if (applications.length === 0) {
                container.innerHTML = '<p>–ù–µ—Ç –∑–∞—è–≤–æ–∫</p>';
                return;
            }
            
            let html = '<h3>üìã –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫</h3>';
            
            applications.forEach(app => {
                html += `
                    <div style="border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px;">
                        <h4>${app.projectTitle}</h4>
                        <p><strong>–§–ò–û:</strong> ${app.fullName}</p>
                        <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> ${app.phone}</p>
                        <p><strong>Email:</strong> ${app.email || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
                        <p><strong>–°—Ç–∞–≤–∫–∞:</strong> ${app.rate || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
                        <p><strong>–î–∞—Ç–∞ —Å—Ç–∞—Ä—Ç–∞:</strong> ${app.startDate ? new Date(app.startDate).toLocaleDateString() : '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</p>
                        <p><strong>–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:</strong> ${app.estimatedDuration ? `${app.estimatedDuration} ${app.estimatedDurationUnit}` : '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</p>
                        <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${app.projectDescription}</p>
                        ${app.coverLetter ? `<p><strong>–°–æ–ø—Ä–æ–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∏—Å—å–º–æ:</strong> ${app.coverLetter}</p>` : ''}
                        ${app.techSpecFile ? `<p><strong>–§–∞–π–ª –¢–ó:</strong> ${app.techSpecFile.originalName} (${(app.techSpecFile.size / 1024 / 1024).toFixed(2)} MB)</p>` : ''}
                        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span style="color: ${app.status === 'pending' ? 'orange' : app.status === 'approved' ? 'green' : 'red'}">${app.status}</span></p>
                        <p><strong>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</strong> ${new Date(app.createdAt).toLocaleString()}</p>
                        
                        ${app.status === 'pending' ? `
                            <div style="margin-top: 10px;">
                                <select id="pm-${app.id}" style="margin-right: 10px;">
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ PM</option>
                                    ${projectManagers.map(pm => `<option value="${pm.uid}">${pm.fullName || pm.displayName || pm.email}</option>`).join('')}
                                </select>
                                <button onclick="approveApplication('${app.id}')" style="background-color: green;">–û–¥–æ–±—Ä–∏—Ç—å</button>
                                <button onclick="rejectApplication('${app.id}')" style="background-color: red;">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Approve application
        async function approveApplication(applicationId) {
            const pmSelect = document.getElementById(`pm-${applicationId}`);
            const pmId = pmSelect.value;
            
            if (!pmId) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä–∞');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/applications/${applicationId}/approve`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ pmId })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    alert('‚úÖ –ó–∞—è–≤–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∞ –∏ –ø—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω!');
                    loadApplications(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
                } else {
                    throw new Error(result.message || '–û—à–∏–±–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∏—è –∑–∞—è–≤–∫–∏');
                }
            } catch (error) {
                alert(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
            }
        }

        // Reject application
        async function rejectApplication(applicationId) {
            const reason = prompt('–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):');
            
            try {
                const response = await fetch(`${API_BASE}/applications/${applicationId}/reject`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ reason })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    alert('‚úÖ –ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞!');
                    loadApplications(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫
                } else {
                    throw new Error(result.message || '–û—à–∏–±–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –∑–∞—è–≤–∫–∏');
                }
            } catch (error) {
                alert(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
            }
        }
    </script>
</body>
</html> 