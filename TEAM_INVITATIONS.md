# Функциональность приглашений в команду

## Обзор

Реализована полная система приглашений в команду для платформы Taska, включающая:
- Поиск и фильтрацию пользователей
- Отправку приглашений в команду
- Прямое добавление участников (для авторизованных пользователей)
- Управление ролями и правами доступа

## Компоненты

### 1. AddMemberModal
**Файл:** `frontend/src/screens/Screen/sections/TeamsView/AddMemberModal.tsx`

**Функциональность:**
- Поиск пользователей по имени, email, специализации
- Фильтрация по специальностям (Front-End, Back-End, VUE.JS, REACT.JS, etc.)
- Множественный выбор пользователей
- Отправка приглашений выбранным пользователям
- Отображение информации о пользователях (имя, рейтинг, специализация)

**Особенности:**
- Загружает только пользователей с ролями 'executor' или 'developer'
- Поддерживает поиск в реальном времени
- Показывает количество выбранных пользователей
- Обработка ошибок авторизации и прав доступа

### 2. ProposalModal
**Файл:** `frontend/src/screens/Screen/sections/TeamsView/ProposalModal.tsx`

**Функциональность:**
- Форма для отправки предложения о сотрудничестве
- Выбор типа проекта (с проектом/без проекта)
- Указание ставки, даты старта, времени реализации
- Загрузка технического задания
- Сопроводительное письмо

**Поля формы:**
- Тип проекта (радио-кнопки)
- Ставка (текстовое поле)
- Дата старта проекта (date picker)
- Оценочное время реализации (число + единица измерения)
- Техническое задание (загрузка файла)
- Сопроводительное письмо (обязательное поле)

### 3. TeamsView (обновленный)
**Файл:** `frontend/src/screens/Screen/sections/TeamsView/index.tsx`

**Новая функциональность:**
- Интеграция модальных окон AddMemberModal и ProposalModal
- Кнопки "Добавить в команду" и "Выбрать команду"
- Обновление данных команды после добавления участников
- Улучшенное отображение участников команды

## API Endpoints

### 1. GET /api/teams
**Описание:** Получение списка всех команд
**Авторизация:** Требуется
**Ответ:** Массив команд с участниками и PM

### 2. GET /api/teams/:teamId/available-users
**Описание:** Получение списка пользователей для добавления в команду
**Авторизация:** Требуется
**Параметры запроса:**
- `search` (optional) - поисковый запрос

**Ответ:** Массив доступных пользователей (исключая текущих участников)

### 3. POST /api/teams/:teamId/invite
**Описание:** Отправка приглашения в команду
**Авторизация:** Требуется
**Тело запроса:**
```json
{
  "receiverId": "string",
  "projectType": "with_project" | "without_project",
  "rate": "string",
  "startDate": "string",
  "estimatedDuration": "string",
  "estimatedDurationUnit": "days" | "weeks" | "months",
  "coverLetter": "string"
}
```

### 4. POST /api/teams/:teamId/members
**Описание:** Прямое добавление участника в команду
**Авторизация:** Требуется (PM, admin, team lead)
**Тело запроса:**
```json
{
  "userId": "string",
  "role": "string"
}
```

## Права доступа

### Отправка приглашений
- Любой авторизованный пользователь может отправлять приглашения
- Приглашения сохраняются в коллекции `team_invitations`

### Прямое добавление участников
- Только PM, admin или team lead могут добавлять участников напрямую
- Участники добавляются сразу в команду

### Просмотр команд
- Все авторизованные пользователи могут просматривать команды
- Доступ к деталям команды требует авторизации

## Структуры данных

### TeamInvitation
```typescript
interface TeamInvitation {
  teamId: string;
  senderId: string;
  receiverId: string;
  projectType: 'with_project' | 'without_project';
  rate?: string;
  startDate?: string;
  estimatedDuration?: string;
  estimatedDurationUnit?: 'days' | 'weeks' | 'months';
  coverLetter: string;
  status: 'pending' | 'accepted' | 'rejected';
  createdAt: Timestamp;
  updatedAt: Timestamp;
}
```

### TeamMember
```typescript
interface TeamMember {
  id: string;
  uid: string;
  name: string;
  email: string;
  avatar?: string;
  role: string;
  rating?: string;
  status?: 'online' | 'offline';
  lastSeen?: string;
  addedAt: Timestamp;
}
```

## Тестирование

### Автоматические тесты
**Файл:** `scripts/test-team-invitations.js`

**Проверяет:**
- Доступность всех эндпоинтов
- Правильную работу авторизации
- Защиту от несанкционированного доступа

**Запуск:**
```bash
node scripts/test-team-invitations.js
```

### Ручное тестирование
1. Откройте раздел "Команды" в приложении
2. Выберите команду для просмотра деталей
3. Нажмите "Добавить в команду" для открытия модального окна
4. Протестируйте поиск и фильтрацию пользователей
5. Выберите пользователей и отправьте приглашения
6. Проверьте кнопку "Выбрать команду" для отправки предложения

## Известные ограничения

1. **Firebase Auth:** Для полного тестирования требуется настройка Firebase Authentication
2. **Индексы Firestore:** Некоторые запросы требуют создания составных индексов
3. **Файловые загрузки:** Загрузка технических заданий требует настройки Firebase Storage
4. **Уведомления:** Система уведомлений о приглашениях не реализована

## Будущие улучшения

1. **Уведомления в реальном времени** о новых приглашениях
2. **Система одобрения приглашений** получателями
3. **История приглашений** и их статусов
4. **Расширенные фильтры** по навыкам и опыту
5. **Интеграция с календарем** для планирования проектов
6. **Система рейтингов** и отзывов о работе в команде

## Интеграция

### Подключение к существующему проекту
1. Убедитесь, что маршруты команд подключены в `src/app.js`
2. Импортируйте компоненты в нужные разделы
3. Настройте Firebase Authentication для полной функциональности
4. Создайте необходимые индексы в Firestore

### Зависимости
- React 18+
- TypeScript
- Tailwind CSS
- Firebase Admin SDK
- Express.js
- Axios для HTTP запросов

## Заключение

Реализованная функциональность предоставляет полноценную систему управления командами с возможностью поиска, приглашения и добавления участников. Система готова к использованию и может быть легко расширена дополнительными функциями. 